(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{379:function(t,a,s){"use strict";s.r(a);var e=s(26),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"beats入门简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#beats入门简介"}},[t._v("#")]),t._v(" Beats入门简介")]),t._v(" "),s("p",[t._v("使用Beat收集nginx日志和指标数据")]),t._v(" "),s("h2",{attrs:{id:"项目需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目需求"}},[t._v("#")]),t._v(" 项目需求")]),t._v(" "),s("p",[t._v("Nginx是一款非常优秀的web服务器，往往nginx服务会作为项目的访问入口，那么，nginx的性能保障就变得非常重要了，如果nginx的运行出现了问题就会对项目有较大的影响，所以，我们需要对nginx的运行有监控措施，实时掌握nginx的运行情况，那就需要收集nginx的运行指标和分析nginx的运行日志了。")]),t._v(" "),s("h2",{attrs:{id:"业务流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务流程"}},[t._v("#")]),t._v(" 业务流程")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924081614472.png",alt:"image-20200924081614472"}})]),t._v(" "),s("p",[t._v("说明：")]),t._v(" "),s("ul",[s("li",[t._v("通过Beats采集Nginx的指标数据和日志数据")]),t._v(" "),s("li",[t._v("Beats采集到数据后发送到Elasticsearch中")]),t._v(" "),s("li",[t._v("Kibana读取数据进行分析")]),t._v(" "),s("li",[t._v("用户通过Kibana进行查看分析报表")])]),t._v(" "),s("h2",{attrs:{id:"部署nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署nginx"}},[t._v("#")]),t._v(" 部署Nginx")]),t._v(" "),s("p",[t._v("部署教程可以参考这篇博客："),s("a",{attrs:{href:"http://www.moguit.cn/#/info?blogUid=e8d3e38ba35b4765ae128256eb44e341",target:"_blank",rel:"noopener noreferrer"}},[t._v("CentOS下如何安装Nginx？"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("部署完成后，我们就可以启动nginx了")]),t._v(" "),s("p",[t._v("启动完成后，我们通过下面命令，就可以获取到nginx中的内容了")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" -f /var/log/nginx/access.log\n")])])]),s("h2",{attrs:{id:"beats简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#beats简介"}},[t._v("#")]),t._v(" Beats简介")]),t._v(" "),s("p",[t._v("通过查看ElasticStack可以发现，Beats主要用于采集数据")]),t._v(" "),s("p",[t._v("官网地址：https://www.elastic.co/cn/beats/")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924091657242.png",alt:"image-20200924091657242"}})]),t._v(" "),s("p",[t._v("Beats平台其实是一个轻量性数据采集器，通过集合多种单一用途的采集器，从成百上千台机器中向Logstash或ElasticSearch中发送数据。")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924091716757.png",alt:"image-20200924091716757"}})]),t._v(" "),s("p",[t._v("通过Beats包含以下的数据采集功能")]),t._v(" "),s("ul",[s("li",[t._v("Filebeat：采集日志文件")]),t._v(" "),s("li",[t._v("Metricbeat：采集指标")]),t._v(" "),s("li",[t._v("Packetbeat：采集网络数据")])]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924092015934.png",alt:"image-20200924092015934"}})]),t._v(" "),s("p",[t._v("如果我们的数据不需要任何处理，那么就可以直接发送到ElasticSearch中")]),t._v(" "),s("p",[t._v("如果们的数据需要经过一些处理的话，那么就可以发送到Logstash中，然后处理完成后，在发送到ElasticSearch")]),t._v(" "),s("p",[t._v("最后在通过Kibana对我们的数据进行一系列的可视化展示")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924092348121.png",alt:"image-20200924092348121"}})]),t._v(" "),s("h2",{attrs:{id:"filebeat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filebeat"}},[t._v("#")]),t._v(" Filebeat")]),t._v(" "),s("h3",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("p",[t._v("Filebeat是一个轻量级的日志采集器")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924092551044.png",alt:"image-20200924092551044"}})]),t._v(" "),s("h3",{attrs:{id:"为什么要用filebeat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用filebeat"}},[t._v("#")]),t._v(" 为什么要用Filebeat？")]),t._v(" "),s("p",[t._v("当你面对成百上千、甚至成千上万的服务器、虚拟机和溶气气生成的日志时，请告别SSH吧！Filebeat将为你提供一种轻量型方法，用于转发和汇总日志与文件，让简单的事情不再繁华，关于Filebeat的记住以下两点：")]),t._v(" "),s("ul",[s("li",[t._v("轻量级日志采集器")]),t._v(" "),s("li",[t._v("输送至ElasticSearch或者Logstash，在Kibana中实现可视化")])]),t._v(" "),s("h3",{attrs:{id:"架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[t._v("#")]),t._v(" 架构")]),t._v(" "),s("p",[t._v("用于监控、收集服务器日志文件.")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924092749077.png",alt:"image-20200924092749077"}})]),t._v(" "),s("p",[t._v("流程如下：")]),t._v(" "),s("ul",[s("li",[t._v("首先是input输入，我们可以指定多个数据输入源，然后通过通配符进行日志文件的匹配")]),t._v(" "),s("li",[t._v("匹配到日志后，就会使用Harvester（收割机），将日志源源不断的读取到来")]),t._v(" "),s("li",[t._v("然后收割机收割到的日志，就传递到Spooler（卷轴），然后卷轴就在将他们传到对应的地方")])]),t._v(" "),s("h3",{attrs:{id:"下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[t._v("#")]),t._v(" 下载")]),t._v(" "),s("p",[t._v("官网地址：https://www.elastic.co/cn/downloads/beats/filebeat")]),t._v(" "),s("p",[t._v("选中对应版本的Filebeat，我这里是Centos部署的，所以下载Linux版本")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924093459418.png",alt:"image-20200924093459418"}})]),t._v(" "),s("p",[t._v("下载后，我们上传到服务器上，然后创建一个文件夹")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建文件夹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /soft/beats\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解压文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf filebeat-7.9.1-linux-x86_64.tar.gz \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重命名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" filebeat-7.9.1-linux-x86_64/ filebeat\n")])])]),s("p",[t._v("然后我们进入到filebeat目录下，创建对应的配置文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入文件夹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" filebeats\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建配置文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" mogublog.yml\n")])])]),s("p",[t._v("添加如下内容")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# filebeat input输入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stdin    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 标准输入")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用标准输入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定下载数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 控制台输出")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pretty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用美化功能")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("h3",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),s("p",[t._v("在我们添加完配置文件后，我们就可以对filebeat进行启动了")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./filebeat -e -c mogublog.yml\n")])])]),s("p",[s("img",{attrs:{src:"images/image-20200924094825962.png",alt:"image-20200924094825962"}})]),t._v(" "),s("p",[t._v("然后我们在控制台输入hello，就能看到我们会有一个json的输出，是通过读取到我们控制台的内容后输出的")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924095032365.png",alt:"image-20200924095032365"}})]),t._v(" "),s("p",[t._v("内容如下")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-01-12T12:50:03.585Z"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@metadata"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" #元数据信息\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"beat"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"filebeat"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"doc"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6.5.4"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"source"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"offset"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" #元数据信息\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"prospector"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stdin"')]),t._v(" #元数据信息\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"input"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" #控制台标准输入\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stdin"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"beat"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  #beat版本以及主机信息\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"itcast01"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hostname"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ElasticStack"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6.5.4"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"host"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ElasticStack"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"读取文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读取文件"}},[t._v("#")]),t._v(" 读取文件")]),t._v(" "),s("p",[t._v("我们需要再次创建一个文件，叫 mogublog-log.yml，然后在文件里添加如下内容")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /soft/beats/logs/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.console")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pretty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("添加完成后，我们在到下面目录创建一个日志文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建文件夹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /soft/beats/logs\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入文件夹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /soft/beats/logs\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 追加内容")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" a.log\n")])])]),s("p",[t._v("然后我们再次启动filebeat")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v(" ./filebeat -e -c mogublog-log.yml\n")])])]),s("p",[t._v("能够发现，它已经成功加载到了我们的日志文件 a.log")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924095926036.png",alt:"image-20200924095926036"}})]),t._v(" "),s("p",[t._v("同时我们还可以继续往文件中追加内容")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"are you ok ?"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" a.log\n")])])]),s("p",[t._v("追加后，我们再次查看filebeat，也能看到刚刚我们追加的内容")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924102409656.png",alt:"image-20200924102409656"}})]),t._v(" "),s("p",[t._v("可以看出，已经检测到日志文件有更新，立刻就会读取到更新的内容，并且输出到控制台。")]),t._v(" "),s("h3",{attrs:{id:"自定义字段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义字段"}},[t._v("#")]),t._v(" 自定义字段")]),t._v(" "),s("p",[t._v("但我们的元数据没办法支撑我们的业务时，我们还可以自定义添加一些字段")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("filebeat.inputs:\n- type: log\n  enabled: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  paths:\n    - /soft/beats/logs/*.log\n  tags: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加自定义tag，便于后续的处理")]),t._v("\n  fields:  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加自定义字段")]),t._v("\n    from: test-web\n  fields_under_root: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#true为添加到根节点，false为添加到子节点中")]),t._v("\nsetup.template.settings:\n  index.number_of_shards: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\noutput.console:\n  pretty: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  enable: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("添加完成后，我们重启 filebeat")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./filebeat -e -c mogublog-log.yml\n")])])]),s("p",[t._v("然后添加新的数据到 a.log中")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-web"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" a.log\n")])])]),s("p",[t._v("我们就可以看到字段在原来的基础上，增加了两个")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924103323033.png",alt:"image-20200924103323033"}})]),t._v(" "),s("h3",{attrs:{id:"输出到elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#输出到elasticsearch"}},[t._v("#")]),t._v(" 输出到ElasticSearch")]),t._v(" "),s("p",[t._v("我们可以通过配置，将修改成如下所示")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /soft/beats/logs/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("web\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields_under_root")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.elasticsearch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:9200"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("启动成功后，我们就能看到它已经成功连接到了es了")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924145624812.png",alt:"image-20200924145624812"}})]),t._v(" "),s("p",[t._v("然后我们到刚刚的 logs文件夹向 a.log文件中添加内容")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello mogublog"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" a.log\n")])])]),s("p",[t._v("在ES中，我们可以看到，多出了一个 filebeat的索引库")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924145928050.png",alt:"image-20200924145928050"}})]),t._v(" "),s("p",[t._v("然后我们浏览对应的数据，看看是否有插入的数据内容")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924150500441.png",alt:"image-20200924150500441"}})]),t._v(" "),s("h3",{attrs:{id:"filebeat工作原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filebeat工作原理"}},[t._v("#")]),t._v(" Filebeat工作原理")]),t._v(" "),s("p",[t._v("Filebeat主要由下面几个组件组成： harvester、prospector 、input")]),t._v(" "),s("h4",{attrs:{id:"harvester"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#harvester"}},[t._v("#")]),t._v(" harvester")]),t._v(" "),s("ul",[s("li",[t._v("负责读取单个文件的内容")]),t._v(" "),s("li",[t._v("harvester逐行读取每个文件（一行一行读取），并把这些内容发送到输出")]),t._v(" "),s("li",[t._v("每个文件启动一个harvester，并且harvester负责打开和关闭这些文件，这就意味着harvester运行时文件描述符保持着打开的状态。")]),t._v(" "),s("li",[t._v("在harvester正在读取文件内容的时候，文件被删除或者重命名了，那么Filebeat就会续读这个文件，这就会造成一个问题，就是只要负责这个文件的harvester没用关闭，那么磁盘空间就不会被释放，默认情况下，Filebeat保存问价你打开直到close_inactive到达")])]),t._v(" "),s("h4",{attrs:{id:"prospector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prospector"}},[t._v("#")]),t._v(" prospector")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("prospector负责管理harvester并找到所有要读取的文件来源")])]),t._v(" "),s("li",[s("p",[t._v("如果输入类型为日志，则查找器将查找路径匹配的所有文件，并为每个文件启动一个harvester")])]),t._v(" "),s("li",[s("p",[t._v("Filebeat目前支持两种prospector类型：log和stdin")])]),t._v(" "),s("li",[s("p",[t._v("Filebeat如何保持文件的状态")]),t._v(" "),s("ul",[s("li",[t._v("Filebeat保存每个文件的状态并经常将状态刷新到磁盘上的注册文件中")]),t._v(" "),s("li",[t._v("该状态用于记住harvester正在读取的最后偏移量，并确保发送所有日志行。")]),t._v(" "),s("li",[t._v("如果输出（例如ElasticSearch或Logstash）无法访问，Filebeat会跟踪最后发送的行，并在输出再次可以用时继续读取文件。")]),t._v(" "),s("li",[t._v("在Filebeat运行时，每个prospector内存中也会保存的文件状态信息，当重新启动Filebat时，将使用注册文件的数量来重建文件状态，Filebeat将每个harvester在从保存的最后偏移量继续读取")]),t._v(" "),s("li",[t._v("文件状态记录在data/registry文件中")])])])]),t._v(" "),s("h3",{attrs:{id:"input"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#input"}},[t._v("#")]),t._v(" input")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("一个input负责管理harvester，并找到所有要读取的源")])]),t._v(" "),s("li",[s("p",[t._v("如果input类型是log，则input查找驱动器上与已定义的glob路径匹配的所有文件，并为每个文件启动一个harvester")])]),t._v(" "),s("li",[s("p",[t._v("每个input都在自己的Go例程中运行")])]),t._v(" "),s("li",[s("p",[t._v("下面的例子配置Filebeat从所有匹配指定的glob模式的文件中读取行")])])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/log/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /var/path2/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n")])])]),s("h3",{attrs:{id:"启动命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动命令"}},[t._v("#")]),t._v(" 启动命令")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./filebeat -e -c mogublog-es.yml\n./filebeat -e -c mogublog-es.yml -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"publish"')]),t._v("\n")])])]),s("h3",{attrs:{id:"参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),s("ul",[s("li",[t._v("**-e：**输出到标准输出，默认输出到syslog和logs下")]),t._v(" "),s("li",[t._v("**-c：**指定配置文件")]),t._v(" "),s("li",[t._v("**-d：**输出debug信息")])]),t._v(" "),s("h3",{attrs:{id:"读取nginx中的配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#读取nginx中的配置文件"}},[t._v("#")]),t._v(" 读取Nginx中的配置文件")]),t._v(" "),s("p",[t._v("我们需要创建一个 mogublog-nginx.yml配置文件")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" log\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /soft/nginx/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.log")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fields_under_root")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.elasticsearch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:9200"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("启动后，可以在Elasticsearch中看到索引以及查看数据")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924161739842.png",alt:"image-20200924161739842"}})]),t._v(" "),s("p",[t._v("可以看到，在message中已经获取到了nginx的日志，但是，内容并没有经过处理，只是读取到原数据，那么对于我们后期的操作是不利的，有办法解决吗？")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924161814066.png",alt:"image-20200924161814066"}})]),t._v(" "),s("h3",{attrs:{id:"module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#module"}},[t._v("#")]),t._v(" Module")]),t._v(" "),s("p",[t._v("前面要想实现日志数据的读取以及处理都是自己手动配置的，其实，在Filebeat中，有大量的Module，可以简化我们的配置，直接就可以使用，如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./filebeat modules list\n")])])]),s("p",[t._v("得到的列表如下所示")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("Disabled:\nactivemq\napache\nauditd\naws\nazure\nbarracuda\nbluecoat\ncef\ncheckpoint\ncisco\ncoredns\ncrowdstrike\ncylance\nelasticsearch\nenvoyproxy\nf5\nfortinet\ngooglecloud\ngsuite\nhaproxy\nibmmq\nicinga\niis\nimperva\ninfoblox\niptables\njuniper\nkafka\nkibana\nlogstash\nmicrosoft\nmisp\nmongodb\nmssql\nmysql\nnats\nnetflow\nnetscout\nnginx\no365\nokta\nosquery\npanw\npostgresql\nrabbitmq\nradware\nredis\nsanta\nsonicwall\nsophos\nsquid\nsuricata\nsystem\ntomcat\ntraefik\nzeek\nzscaler\n")])])]),s("p",[t._v("可以看到，内置了很多的module，但是都没有启用，如果需要启用需要进行enable操作：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n./filebeat modules "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" nginx \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#禁用")]),t._v("\n./filebeat modules disable nginx \n")])])]),s("p",[t._v("可以发现，nginx的module已经被启用。")]),t._v(" "),s("h4",{attrs:{id:"nginx-module-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-module-配置"}},[t._v("#")]),t._v(" nginx module 配置")]),t._v(" "),s("p",[t._v("我们到下面的目录，就能看到module的配置了")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入到module目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" modules.d/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" nginx.yml.disabled\n")])])]),s("p",[t._v("得到的文件内容如下所示")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Module: nginx")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docs: https://www.elastic.co/guide/en/beats/filebeat/7.9/filebeat-module-nginx.html")]),t._v("\n\n- module: nginx\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Access logs")]),t._v("\n  access:\n    enabled: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加日志文件")]),t._v("\n    var.paths: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/log/nginx/access.log*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set custom paths for the log files. If left empty,")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Filebeat will choose the paths depending on your OS.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#var.paths:")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Error logs")]),t._v("\n  error:\n    enabled: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    var.paths: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/log/nginx/error.log*"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h4",{attrs:{id:"配置filebeat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置filebeat"}},[t._v("#")]),t._v(" 配置filebeat")]),t._v(" "),s("p",[t._v("我们需要修改刚刚的mogublog-nginx.yml文件，然后添加到我们的module")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.inputs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.elasticsearch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:9200"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filebeat.config.modules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("path.config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/modules.d/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.yml")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reload.enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n")])])]),s("h4",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),s("p",[t._v("我们启动我们的filebeat")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./filebeat -e -c itcast-nginx.yml\n")])])]),s("p",[t._v("如果启动的时候发现出错了，错误如下所示，执行如图所示的脚本即可 【新版本的ES好像不会出现这个错误】")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动会出错，如下")]),t._v("\nERROR fileset/factory.go:142 Error loading pipeline: Error loading pipeline "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v("\nfileset nginx/access: This module requires the following Elasticsearch plugins:\ningest-user-agent, ingest-geoip. You can "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" them by running the following\ncommands on all the Elasticsearch nodes:\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" bin/elasticsearch-plugin "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ingest-user-agent\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" bin/elasticsearch-plugin "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ingest-geoip\n\n")])])]),s("p",[t._v("启动成功后，能看到日志记录已经成功刷新进去了")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924164750123.png",alt:"image-20200924164750123"}})]),t._v(" "),s("p",[t._v("我们可以测试一下，刷新nginx页面，或者向错误日志中，插入数据")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"err"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" error.log\n")])])]),s("p",[t._v("能够看到，刚刚的记录已经成功插入了")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924164927557.png",alt:"image-20200924164927557"}})]),t._v(" "),s("p",[t._v("关于module的其它使用，可以参考文档：")]),t._v(" "),s("p",[t._v("https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html")]),t._v(" "),s("h2",{attrs:{id:"metricbeat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metricbeat"}},[t._v("#")]),t._v(" Metricbeat")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924170741928.png",alt:"image-20200924170741928"}})]),t._v(" "),s("ul",[s("li",[t._v("定期收集操作系统或应用服务的指标数据")]),t._v(" "),s("li",[t._v("存储到Elasticsearch中，进行实时分析")])]),t._v(" "),s("h3",{attrs:{id:"metricbeat组成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metricbeat组成"}},[t._v("#")]),t._v(" Metricbeat组成")]),t._v(" "),s("p",[t._v("Metricbeat有2部分组成，一部分是Module，另一个部分为Metricset")]),t._v(" "),s("ul",[s("li",[t._v("Module\n"),s("ul",[s("li",[t._v("收集的对象：如 MySQL、Redis、Nginx、操作系统等")])])]),t._v(" "),s("li",[t._v("Metricset\n"),s("ul",[s("li",[t._v("收集指标的集合：如 cpu、memory，network等")])])])]),t._v(" "),s("p",[t._v("以Redis Module为例：")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924170958343.png",alt:"image-20200924170958343"}})]),t._v(" "),s("h3",{attrs:{id:"下载-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载-2"}},[t._v("#")]),t._v(" 下载")]),t._v(" "),s("p",[t._v("首先我们到"),s("a",{attrs:{href:"https://www.elastic.co/cn/downloads/beats/metricbeat",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),s("OutboundLink")],1),t._v("，找到Metricbeat进行下载")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924171232384.png",alt:"image-20200924171232384"}})]),t._v(" "),s("p",[t._v("下载完成后，我们通过xftp工具，移动到指定的目录下")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 移动到该目录下")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /soft/beats\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解压文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改文件名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v("  metricbeat\n")])])]),s("p",[t._v("然后修改配置文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" metricbeat.yml\n")])])]),s("p",[t._v("添加如下内容")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metricbeat.config.modules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("path.config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/modules.d/"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("*.yml")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reload.enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.template.settings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.number_of_shards")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("index.codec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" best_compression\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("setup.kibana")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("output.elasticsearch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v('""127.0.0.1'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('9200"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("processors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add_host_metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add_cloud_metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("~")]),t._v("\n")])])]),s("p",[t._v("默认会指定的配置文件，就是在")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${path.config}")]),t._v("/modules.d/*.yml\n")])])]),s("p",[t._v("也就是 system.yml文件，我们也可以自行开启其它的收集")]),t._v(" "),s("h3",{attrs:{id:"启动-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-2"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),s("p",[t._v("在配置完成后，我们通过如下命令启动即可")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("./metricbeat -e\n")])])]),s("p",[t._v("在ELasticsearch中可以看到，系统的一些指标数据已经写入进去了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924171839291.png",alt:"image-20200924171839291"}})]),t._v(" "),s("h3",{attrs:{id:"system-module配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#system-module配置"}},[t._v("#")]),t._v(" system module配置")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" system\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("period")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采集的频率，每10秒采集一次")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metricsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 采集的内容")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" cpu\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" load\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" memory\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" network\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" process\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" process_summary\n")])])]),s("h3",{attrs:{id:"metricbeat-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metricbeat-module"}},[t._v("#")]),t._v(" Metricbeat Module")]),t._v(" "),s("p",[t._v("Metricbeat Module的用法和我们之前学的filebeat的用法差不多")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看列表")]),t._v("\n./metricbeat modules list \n")])])]),s("p",[t._v("能够看到对应的列表")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("Enabled:\nsystem "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认启用")]),t._v("\n\nDisabled:\naerospike\napache\nceph\ncouchbase\ndocker\ndropwizard\nelasticsearch\nenvoyproxy\netcd\ngolang\ngraphite\nhaproxy\nhttp\njolokia\nkafka\nkibana\nkubernetes\nkvm\nlogstash\nmemcached\nmongodb\nmunin\nmysql\nnginx\nphp_fpm\npostgresql\nprometheus\nrabbitmq\nredis\ntraefik\nuwsgi\nvsphere\nwindows\n")])])]),s("h3",{attrs:{id:"nginx-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-module"}},[t._v("#")]),t._v(" Nginx Module")]),t._v(" "),s("h4",{attrs:{id:"开启nginx-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启nginx-module"}},[t._v("#")]),t._v(" 开启Nginx Module")]),t._v(" "),s("p",[t._v("在nginx中，需要开启状态查询，才能查询到指标数据。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重新编译nginx")]),t._v("\n./configure --prefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx --with-http_stub_status_module\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n\n./nginx -V "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询版本信息")]),t._v("\nnginx version: nginx/1.11.6\nbuilt by gcc "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.4")]),t._v(".7 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20120313")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Red Hat "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4.4")]),t._v(".7-23"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GCC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconfigure arguments: --prefix"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/nginx --with-http_stub_status_module\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置nginx")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" nginx.conf\nlocation /nginx-status "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    stub_status on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    access_log off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启nginx")]),t._v("\n./nginx -s reload\n")])])]),s("p",[t._v("测试")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924172317526.png",alt:"image-20200924172317526"}})]),t._v(" "),s("p",[t._v("结果说明：")]),t._v(" "),s("ul",[s("li",[t._v("Active connections：正在处理的活动连接数")]),t._v(" "),s("li",[t._v("server accepts handled requests\n"),s("ul",[s("li",[t._v("第一个 server 表示Nginx启动到现在共处理了9个连接")]),t._v(" "),s("li",[t._v("第二个 accepts 表示Nginx启动到现在共成功创建 9 次握手")]),t._v(" "),s("li",[t._v("第三个 handled requests 表示总共处理了 21 次请求")]),t._v(" "),s("li",[t._v("请求丢失数 = 握手数 - 连接数 ，可以看出目前为止没有丢失请求")])])]),t._v(" "),s("li",[t._v("Reading: 0 Writing: 1 Waiting: 1\n"),s("ul",[s("li",[t._v("Reading：Nginx 读取到客户端的 Header 信息数")]),t._v(" "),s("li",[t._v("Writing：Nginx 返回给客户端 Header 信息数")]),t._v(" "),s("li",[t._v("Waiting：Nginx 已经处理完正在等候下一次请求指令的驻留链接（开启keep-alive的情况下，这个值等于\nActive - (Reading+Writing)）")])])])]),t._v(" "),s("h3",{attrs:{id:"配置nginx-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx-module"}},[t._v("#")]),t._v(" 配置nginx module")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用redis module")]),t._v("\n./metricbeat modules "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改redis module配置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" modules.d/nginx.yml\n")])])]),s("p",[t._v("然后修改下面的信息")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Module: nginx")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docs: https://www.elastic.co/guide/en/beats/metricbeat/6.5/metricbeat-modulenginx.")]),t._v("\nhtml\n  - module: nginx\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#metricsets:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - stubstatus")]),t._v("\n  period: 10s\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Nginx hosts")]),t._v("\n  hosts: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Path to server status. Default server-status")]),t._v("\n  server_status_path: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx-status"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#username: "user"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#password: "secret"')]),t._v("\n")])])]),s("p",[t._v("修改完成后，启动nginx")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n./metricbeat -e\n")])])]),s("h3",{attrs:{id:"测试-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试-2"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),s("p",[t._v("我们能看到，我们的nginx数据已经成功的采集到我们的系统中了")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/image-20200924173058267.png",alt:"image-20200924173058267"}})]),t._v(" "),s("p",[t._v("可以看到，nginx的指标数据已经写入到了Elasticsearch。")]),t._v(" "),s("p",[t._v("更多的Module使用参见官方文档：")]),t._v(" "),s("p",[t._v("https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-modules.html")]),t._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/cjsblog/p/9495024.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Filebeat 模块与配置"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.bilibili.com/video/BV1iJ411c7Az",target:"_blank",rel:"noopener noreferrer"}},[t._v("Elastic Stack（ELK）从入门到实践"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);