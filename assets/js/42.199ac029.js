(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{448:function(a,s,t){"use strict";t.r(s);var e=t(26),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"kubernetes容器交付介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes容器交付介绍"}},[a._v("#")]),a._v(" Kubernetes容器交付介绍")]),a._v(" "),t("p",[a._v("如何在k8s集群中部署Java项目")]),a._v(" "),t("h2",{attrs:{id:"容器交付流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器交付流程"}},[a._v("#")]),a._v(" 容器交付流程")]),a._v(" "),t("ul",[t("li",[a._v("开发代码阶段\n"),t("ul",[t("li",[a._v("编写代码")]),a._v(" "),t("li",[a._v("编写Dockerfile【打镜像做准备】")])])]),a._v(" "),t("li",[a._v("持续交付/集成\n"),t("ul",[t("li",[a._v("代码编译打包")]),a._v(" "),t("li",[a._v("制作镜像")]),a._v(" "),t("li",[a._v("上传镜像仓库")])])]),a._v(" "),t("li",[a._v("应用部署\n"),t("ul",[t("li",[a._v("环境准备")]),a._v(" "),t("li",[a._v("Pod")]),a._v(" "),t("li",[a._v("Service")]),a._v(" "),t("li",[a._v("Ingress")])])]),a._v(" "),t("li",[a._v("运维\n"),t("ul",[t("li",[a._v("监控")]),a._v(" "),t("li",[a._v("故障排查")]),a._v(" "),t("li",[a._v("应用升级")])])])]),a._v(" "),t("h2",{attrs:{id:"k8s部署java项目流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#k8s部署java项目流程"}},[a._v("#")]),a._v(" k8s部署Java项目流程")]),a._v(" "),t("ul",[t("li",[a._v("制作镜像【Dockerfile】")]),a._v(" "),t("li",[a._v("上传到镜像仓库【Dockerhub、阿里云、网易】")]),a._v(" "),t("li",[a._v("控制器部署镜像【Deployment】")]),a._v(" "),t("li",[a._v("对外暴露应用【Service、Ingress】")]),a._v(" "),t("li",[a._v("运维【监控、升级】")])]),a._v(" "),t("h2",{attrs:{id:"k8s部署java项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#k8s部署java项目"}},[a._v("#")]),a._v(" k8s部署Java项目")]),a._v(" "),t("h3",{attrs:{id:"准备java项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备java项目"}},[a._v("#")]),a._v(" 准备Java项目")]),a._v(" "),t("p",[a._v("第一步，准备java项目，把java进行打包【jar包或者war包】")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121213239222.png",alt:"image-20201121213239222"}})]),a._v(" "),t("h3",{attrs:{id:"依赖环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖环境"}},[a._v("#")]),a._v(" 依赖环境")]),a._v(" "),t("p",[a._v("在打包java项目的时候，我们首先需要两个环境")]),a._v(" "),t("ul",[t("li",[a._v("java环境【JDK】")]),a._v(" "),t("li",[a._v("maven环境")])]),a._v(" "),t("p",[a._v("然后把java项目打包成jar包")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("mvn clean "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v("\n")])])]),t("p",[t("img",{attrs:{src:"images/image-20201121213654216.png",alt:"image-20201121213654216"}})]),a._v(" "),t("h3",{attrs:{id:"编写dockerfile文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写dockerfile文件"}},[a._v("#")]),a._v(" 编写Dockerfile文件")]),a._v(" "),t("p",[a._v("Dockerfile 内容如下所示")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("FROM openjdk:8-jdk-alpine\nVOLUME /tmp\nADD ./target/demojenkins.jar demojenkins.jar\nENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"java"')]),a._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-jar"')]),a._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/demojenkins.jar"')]),a._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"&"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("h3",{attrs:{id:"制作镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#制作镜像"}},[a._v("#")]),a._v(" 制作镜像")]),a._v(" "),t("p",[a._v("在我们创建好Dockerfile文件后，我们就可以制作镜像了")]),a._v(" "),t("p",[a._v("我们首先将我们的项目，放到我们的服务器上")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121214251023.png",alt:"image-20201121214251023"}})]),a._v(" "),t("p",[a._v("然后执行下面命令打包镜像")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker build -t java-demo-01:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),t("p",[a._v("等待一段后，即可制作完成我们的镜像")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121214701015.png",alt:"image-20201121214701015"}})]),a._v(" "),t("p",[a._v("最后通过下面命令，即可查看我们的镜像了")]),a._v(" "),t("div",{staticClass:"language-BASH extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h3",{attrs:{id:"启动镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动镜像"}},[a._v("#")]),a._v(" 启动镜像")]),a._v(" "),t("p",[a._v("在我们制作完成镜像后，我们就可以启动我们的镜像了")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8111")]),a._v(":8111 java-demo-01:latest -t\n")])])]),t("p",[a._v("启动完成后，我们通过浏览器进行访问，即可看到我们的java程序")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("http://192.168.177.130:8111/user\n")])])]),t("h3",{attrs:{id:"推送镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像"}},[a._v("#")]),a._v(" 推送镜像")]),a._v(" "),t("p",[a._v("下面我们需要将我们制作好的镜像，上传到镜像服务器中【阿里云、DockerHub】")]),a._v(" "),t("p",[a._v("首先我们需要到 阿里云 "),t("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/repositories",target:"_blank",rel:"noopener noreferrer"}},[a._v("容器镜像服务"),t("OutboundLink")],1),a._v("，然后开始创建镜像仓库")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121223435851.png",alt:"image-20201121223435851"}})]),a._v(" "),t("p",[a._v("然后选择本地仓库")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121223516789.png",alt:"image-20201121223516789"}})]),a._v(" "),t("p",[a._v("我们点击我们刚刚创建的镜像仓库，就能看到以下的信息")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121224233092.png",alt:"image-20201121224233092"}})]),a._v(" "),t("h4",{attrs:{id:"登录镜像服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录镜像服务器"}},[a._v("#")]),a._v(" 登录镜像服务器")]),a._v(" "),t("p",[a._v("使用命令登录")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker login --username"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("XXXXXXX@163.com registry.cn-shenzhen.aliyuncs.com\n")])])]),t("p",[a._v("然后输入刚刚我们开放时候的注册的密码")]),a._v(" "),t("h4",{attrs:{id:"镜像添加版本号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像添加版本号"}},[a._v("#")]),a._v(" 镜像添加版本号")]),a._v(" "),t("p",[a._v("下面为我们的镜像添加版本号")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 实例")]),a._v("\ndocker tag "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("ImageId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("镜像版本号"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 举例")]),a._v("\ndocker tag 33f11349c27d registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0\n")])])]),t("p",[a._v("操作完成后")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121224609890.png",alt:"image-20201121224609890"}})]),a._v(" "),t("h4",{attrs:{id:"推送镜像-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像-2"}},[a._v("#")]),a._v(" 推送镜像")]),a._v(" "),t("p",[a._v("在我们添加版本号信息后，我们就可以推送我们的镜像到阿里云了")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker push registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0\n")])])]),t("p",[t("img",{attrs:{src:"images/image-20201121224714068.png",alt:"image-20201121224714068"}})]),a._v(" "),t("p",[a._v("操作完成后，我们在我们的阿里云镜像服务，就能看到推送上来的镜像了")]),a._v(" "),t("p",[t("img",{attrs:{src:"images/image-20201121224858651.png",alt:"image-20201121224858651"}})]),a._v(" "),t("h3",{attrs:{id:"控制器部署镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#控制器部署镜像"}},[a._v("#")]),a._v(" 控制器部署镜像")]),a._v(" "),t("p",[a._v("在我们推送镜像到服务器后，就可以通过控制器部署镜像了")]),a._v(" "),t("p",[a._v("首先我们需要根据刚刚的镜像，导出yaml")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导出yaml")]),a._v("\nkubectl create deployment  javademo1 --image"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.cn-\nshenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0 --dry-run -o yaml "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" javademo1.yaml\n")])])]),t("p",[a._v("导出后的 javademo1.yaml 如下所示")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: javademo1\n  name: javademo1\nspec:\n  replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n  selector:\n    matchLabels:\n      app: javademo1\n  strategy: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: javademo1\n    spec:\n      containers:\n      - image: registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0\n        name: java-project-01\n        resources: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\nstatus: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("然后通过下面命令，通过yaml创建我们的deployment")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建")]),a._v("\nkubectl apply -f javademo1.yaml\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看 pods")]),a._v("\n")])])]),t("p",[t("img",{attrs:{src:"images/image-20201121225413122.png",alt:"image-20201121225413122"}})]),a._v(" "),t("p",[a._v("或者我们可以进行扩容，多创建几个副本")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("kubectl scale deployment javademo1 --replicas"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n")])])]),t("p",[t("img",{attrs:{src:"images/image-20201121225600554.png",alt:"image-20201121225600554"}})]),a._v(" "),t("p",[a._v("然后我们还需要对外暴露端口【通过service 或者 Ingress】")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 对外暴露端口")]),a._v("\nkubectl expose deployment javademo1 --port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8111")]),a._v("  --target-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8111")]),a._v(" --type"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("NodePort\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看对外端口号")]),a._v("\nkubectl get svc\n")])])]),t("p",[t("img",{attrs:{src:"images/image-20201121225818003.png",alt:"image-20201121225818003"}})]),a._v(" "),t("p",[a._v("然后通过下面的地址访问")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 对内访问")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" http://10.106.103.242:8111/user\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 对外访问")]),a._v("\nhttp://192.168.177.130:32190/user\n")])])]),t("h3",{attrs:{id:"运维"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运维"}},[a._v("#")]),a._v(" 运维")]),a._v(" "),t("p",[a._v("....")])])}),[],!1,null,null,null);s.default=r.exports}}]);